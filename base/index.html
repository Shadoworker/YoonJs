<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yoon JS - Main</title>
  <style>
    body {
      margin: 0 auto;
    }

    .draggable-container {
      position: relative;
      width: 400px;
      height: 300px;
      border: 1px solid #ccc;
    }

    .draggable-item {
      position: absolute;
      background-color: #dca5a5;
      padding: 10px;
      cursor: move;
      user-select: none;
    }

    .guide-line {
      position: absolute;
      border-left: 1px dashed #9E41BE;
      border-right: 1px dashed #9E41BE;
      border-top: 1px dashed #9E41BE;
      border-bottom: 1px dashed #9E41BE;
      pointer-events: none;
    }

    .guide-distance {
      position: absolute;
      background-color: #9E41BE;
      color: white;
      padding: 2px 5px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="draggable-container">
    <div class="draggable-item" style="left: 50px; top: 50px;">Element 1</div>
    <div class="draggable-item" style="left: 220px; top: 100px;">Element 2</div>
    <div class="draggable-item" style=" padding: 15px 20px; left: 170px; top: 200px;">Element 3</div>
    <!-- Add more draggable items here -->
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const draggableItems = document.querySelectorAll(".draggable-item");
      const draggableContainer = document.querySelector(".draggable-container");
      let activeItem = null;
      let guides = [];
      const snapThreshold = 4; // Threshold for snapping to guides

      let allowSnap = true;

      draggableItems.forEach((item) => {
        item.addEventListener("mousedown", startDrag);
        item.addEventListener("mouseup", stopDrag);
      });

      function startDrag(e) {
        activeItem = e.target;
        document.addEventListener("mousemove", drag);
      }

      function stopDrag() {
        activeItem = null;
        document.removeEventListener("mousemove", drag);
        removeGuides();
      }

      function drag(e) {
        if (activeItem) {
          const { clientX, clientY } = e;
          activeItem.style.left = clientX - activeItem.offsetWidth / 2 + "px";
          activeItem.style.top = clientY - activeItem.offsetHeight / 2 + "px";

          removeGuides();
          
          showGuides();
          // snapElement();
        }
      }

      function showGuides() {
        const activeBounds = activeItem.getBoundingClientRect();
        const centerBounds = {
          left: activeBounds.left + activeBounds.width / 2,
          top: activeBounds.top + activeBounds.height / 2,
          bottom: activeBounds.bottom,
        };

        activeBounds.top -= 1;
        activeBounds.bottom -= 1;
        centerBounds.top -= 1;

        draggableItems.forEach((item) => {
          if (item !== activeItem) {
            const itemBounds = item.getBoundingClientRect();
            const centerItem = {
              left: itemBounds.left + itemBounds.width / 2,
              top: itemBounds.top + itemBounds.height / 2,
              bottom: itemBounds.bottom,
            };

            itemBounds.top -= 1;
            itemBounds.bottom -= 1;
            centerItem.top -= 1;

            // -----------------------------LEFT / LEFT - LEFT / RIGHT --------------------------------------

            if (Math.abs(activeBounds.left - itemBounds.left) < snapThreshold) {
              
              showVerticalGuide(itemBounds.left, itemBounds.top, itemBounds.height);
              
              var snapPos = itemBounds.left;
              snapAt('h', snapPos);

            }
            if (Math.abs(activeBounds.left - itemBounds.right) < snapThreshold) {
              
              showVerticalGuide(itemBounds.right, itemBounds.top, itemBounds.width);
            
              var snapPos = itemBounds.right;
              snapAt('h', snapPos);

            }

            // --------------------------------------LEFT / CENTER -------------------------------------------

            if (Math.abs(activeBounds.left - centerItem.left) < snapThreshold) {
              
              showVerticalGuide(centerItem.left, activeBounds.top, itemBounds.height);
              
              var snapPos = centerItem.left;
              snapAt('h', snapPos);
            }
           
            // --------------------------------------CENTER / LEFT -------------------------------------------

            if (Math.abs(centerBounds.left - itemBounds.left) < snapThreshold) {
              
              showVerticalGuide(itemBounds.left, activeBounds.top, itemBounds.height);
              
              var snapPos = (itemBounds.left - (activeBounds.width/2));
              snapAt('h', snapPos);
            }

            // --------------------------------------RIGHT / CENTER -------------------------------------------

            if (Math.abs(activeBounds.right - centerItem.left) < snapThreshold) {
                  
              showVerticalGuide(centerItem.left, activeBounds.top, itemBounds.height);
                  
                  var snapPos = (centerItem.left - activeBounds.width);
                  snapAt('h', snapPos);
                }


            // --------------------------------------CENTER / RIGHT -------------------------------------------

            if (Math.abs(centerBounds.left - itemBounds.right) < snapThreshold) {
                
              showVerticalGuide(itemBounds.right, activeBounds.top, itemBounds.height);
                
                var snapPos = (itemBounds.right - (activeBounds.width/2));
                snapAt('h', snapPos);
              }

            // -----------------------------RIGHT / RIGHT - RIGHT / LEFT --------------------------------------

            if (Math.abs(activeBounds.right - itemBounds.right) < snapThreshold) {
              
              showVerticalGuide(itemBounds.right, itemBounds.top, itemBounds.height);
               
              var snapPos = (itemBounds.right-activeBounds.width);
              snapAt('h', snapPos);

            }
            if (Math.abs(activeBounds.right - itemBounds.left) < snapThreshold) {
              
              showVerticalGuide(itemBounds.left, itemBounds.top, itemBounds.height);
              
              var snapPos = (itemBounds.right - (itemBounds.width+activeBounds.width));
              snapAt('h', snapPos);

            }

            // -----------------------------TOP / TOP - TOP / BOTTOM --------------------------------------

            if (Math.abs(activeBounds.top - itemBounds.top) < snapThreshold) {
              
              showHorizontalGuide(itemBounds.top, itemBounds.left, itemBounds.width);
              
              var snapPos = itemBounds.top;
              snapAt('v', snapPos);
              
            }
            if (Math.abs(activeBounds.top - itemBounds.bottom) < snapThreshold) {
              
              showHorizontalGuide(itemBounds.bottom, itemBounds.left, itemBounds.width);
              
              var snapPos = itemBounds.bottom;
              snapAt('v', snapPos);
            }

            // -----------------------------BOTTOM / BOTTOM - BOTTOM / TOP --------------------------------------

            if (Math.abs(activeBounds.bottom - itemBounds.bottom) < snapThreshold) {
              
              showHorizontalGuide(itemBounds.bottom, itemBounds.left, -itemBounds.width);

              var snapPos = (itemBounds.bottom - itemBounds.height + Math.abs(itemBounds.height-activeBounds.height));
              snapAt('v', snapPos);
            }
            if (Math.abs(activeBounds.bottom - itemBounds.top) < snapThreshold) {
              
              showHorizontalGuide(itemBounds.top, itemBounds.top, -itemBounds.width);

              var snapPos = (itemBounds.top - itemBounds.height + Math.abs(itemBounds.height-activeBounds.height));
              snapAt('v', snapPos);
            }

            // -----------------------------CENTER LEFT / CENTER LEFT - CENTER LEFT / CENTER RIGHT ------------------------------------------

            if ((Math.abs(centerBounds.left - centerItem.left) < snapThreshold) && (centerBounds.top < centerItem.top)) //center by top
            {
              
              showVerticalGuide(centerItem.left, centerItem.top, itemBounds.height/2);
              
              var snapPos = (centerItem.left - (activeBounds.width/2));
              snapAt('h', snapPos);
            }

            if ((Math.abs(centerBounds.left - centerItem.left) < snapThreshold) && (centerBounds.top > centerItem.bottom)) //center by bottom
            {
              
              showVerticalGuide(centerItem.left, centerItem.top, itemBounds.height/2);
              
              var snapPos = (centerItem.left - (activeBounds.width/2));
              snapAt('h', snapPos);
            }

            // -----------------------------CENTER TOP / CENTER TOP - CENTER TOP / CENTER BOTTOM --------------------------------------

            if ((Math.abs(centerBounds.top - centerItem.top) < snapThreshold) && (centerBounds.left < centerItem.left)) {
              
              showHorizontalGuide(centerItem.top, centerItem.left, itemBounds.width/2);
              
              var snapPos = (centerItem.top - (activeBounds.height/2));
              snapAt('v', snapPos);
            }

            if ((Math.abs(centerBounds.top - centerItem.top) < snapThreshold) && (centerBounds.left > (centerItem.left+itemBounds.width))) {
              
              showHorizontalGuide(centerItem.top, centerItem.left, itemBounds.width/2);
              
              var snapPos = (centerItem.top - (activeBounds.height/2));
              snapAt('v', snapPos);
            }

            // ---------------------------------------- TOP / CENTER ----------------------------------------------------

            if ((Math.abs(activeBounds.top - centerItem.top) < snapThreshold)) {
              
              showHorizontalGuide(centerItem.top, centerItem.left, itemBounds.width/2);
              
              var snapPos = (centerItem.top);
              snapAt('v', snapPos);
            }
            // ---------------------------------------- BOTTOM / CENTER ----------------------------------------------------

            if ((Math.abs(activeBounds.bottom - centerItem.top) < snapThreshold)) {
              
              showHorizontalGuide(centerItem.top, centerItem.left, itemBounds.width/2);
              
              var snapPos = (centerItem.top - activeBounds.height);
              snapAt('v', snapPos);
            }

            // ---------------------------------------- CENTER / TOP ----------------------------------------------------

            if ((Math.abs(centerBounds.top - itemBounds.top) < snapThreshold)) {
              
              showHorizontalGuide(itemBounds.top, itemBounds.left, itemBounds.width/2);
              
              var snapPos = (itemBounds.top - activeBounds.height/2);
              snapAt('v', snapPos);
            }

            // ---------------------------------------- CENTER / BOTTOM ----------------------------------------------------

            if ((Math.abs(centerBounds.top - itemBounds.bottom) < snapThreshold)) {
              
              showHorizontalGuide(itemBounds.bottom, itemBounds.left, itemBounds.width/2);
            
              var snapPos = (itemBounds.bottom - activeBounds.height/2);
              snapAt('v', snapPos);
            }

  
          }
        });

        // ---------------------------------- MAIN CONTAINER  -----------------------------------------------

        if (Math.abs(centerBounds.left - draggableContainer.clientWidth / 2) < snapThreshold) {
          
          showVerticalGuide(draggableContainer.clientWidth / 2, (draggableContainer.clientHeight / 2), (draggableContainer.clientHeight / 2), true);

          var snapPos = (draggableContainer.clientWidth / 2 - activeBounds.width/2);
          snapAt('h', snapPos);

        }

        if (Math.abs(centerBounds.top - draggableContainer.clientHeight / 2) < snapThreshold) {
          
          showHorizontalGuide(draggableContainer.clientHeight / 2, draggableContainer.clientWidth / 2, (draggableContainer.clientWidth / 2), true);
        
          var snapPos = (draggableContainer.clientHeight / 2 - activeBounds.height/2);
          snapAt('v', snapPos);
        
        }
      }

      function showVerticalGuide(x, targetTop, size, isContainer = false) {
        const guide = createGuideLine(x, 0, draggableContainer.clientHeight, isContainer);
        guides.push(guide);

        const distance = Math.abs(targetTop - activeItem.offsetTop - size);
        displayDistance(x, targetTop, distance);
      }

      function showHorizontalGuide(y, targetLeft, size, isContainer = false) {
        const guide = createGuideLine(0, y, draggableContainer.clientWidth, isContainer);
        guides.push(guide);

        const distance = Math.abs(targetLeft - activeItem.offsetLeft - size);
        displayDistance(targetLeft, y, (distance));
      }

      function createGuideLine(x, y, length, isContainer = false) {
        const guide = document.createElement("div");
        guide.classList.add("guide-line");

        if (x === 0) {
          guide.style.width = length + "px";
        } else {
          guide.style.height = "100%";
        }

        if (isContainer) {
          guide.style.borderColor = "#6941BE";
        }


        guide.style.left = x + "px";
        guide.style.top = y + "px";
        draggableContainer.appendChild(guide);
        return guide;
      }

      function removeGuides() {
        guides.forEach((guide) => guide.remove());
        guides.length = 0;
        const distanceElements = document.querySelectorAll(".guide-distance");
        distanceElements.forEach((el) => el.remove());
      }


      function snapAt(type, pos)
      {
        if(allowSnap)
        {  
          if(type == 'h')
          {
            activeItem.style.left = pos + "px";
          }
          if(type == 'v')
          {
            activeItem.style.top = pos + "px";
          }
        }
          
      
      }

 
      function displayDistance(targetLeft, targetTop, distance) {
        const distanceEl = document.createElement("div");
        distanceEl.classList.add("guide-distance");
        distanceEl.style.left = `${targetLeft}px`;
        distanceEl.style.top = `${targetTop}px`;
        distanceEl.textContent = distance.toFixed(1);
        draggableContainer.appendChild(distanceEl);
      }
    });
  </script>
</body>
</html>
